<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="629px" preserveAspectRatio="none" style="width:1319px;height:629px;" version="1.1" viewBox="0 0 1319 629" width="1319px" zoomAndPan="magnify"><defs><filter height="300%" id="f1x6ai7c2bmgyi" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1x6ai7c2bmgyi)" height="104.5313" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="281.5" y="320.3594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="39" x2="39" y1="86.2969" y2="542.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="179" x2="179" y1="86.2969" y2="542.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="314.5" x2="314.5" y1="86.2969" y2="542.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="529" x2="529" y1="86.2969" y2="542.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="659" x2="659" y1="86.2969" y2="542.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="790" x2="790" y1="86.2969" y2="542.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1040" x2="1040" y1="86.2969" y2="542.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1277.5" x2="1277.5" y1="86.2969" y2="542.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="8" y="82.9951">attacker</text><ellipse cx="39" cy="13" fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M39,21 L39,48 M26,29 L52,29 M39,48 L26,63 M39,48 L52,63 " fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="8" y="554.2842">attacker</text><ellipse cx="39" cy="567.5859" fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M39,575.5859 L39,602.5859 M26,583.5859 L52,583.5859 M39,602.5859 L26,617.5859 M39,602.5859 L52,617.5859 " fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="111" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="118" y="70.9951">SPrivateRSA.pem</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="111" y="541.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="118" x="118" y="561.2842">SPrivateRSA.pem</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="291.5" y="82.9951">target</text><ellipse cx="315" cy="13" fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M315,21 L315,48 M302,29 L328,29 M315,48 L302,63 M315,48 L328,63 " fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="291.5" y="554.2842">target</text><ellipse cx="315" cy="567.5859" fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M315,575.5859 L315,602.5859 M302,583.5859 L328,583.5859 M315,602.5859 L302,617.5859 M315,602.5859 L328,617.5859 " fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="477" y="34.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="484.5" y="54.6982">SPublic.pem</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="484" y="70.9951">(embedded)</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="477" y="541.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="484.5" y="561.2842">SPublic.pem</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="484" y="577.5811">(embedded)</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="591" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="598" y="70.9951">CPrivateRSA.pem</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="591" y="541.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="598" y="561.2842">CPrivateRSA.pem</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="738" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="745" y="70.9951">CPublic.pem</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="738" y="541.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="745" y="561.2842">CPublic.pem</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="1005" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="1012" y="70.9951">AESKey</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="1005" y="541.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="1012" y="561.2842">AESKey</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="37" x="1257.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="23" x="1264.5" y="70.9951">File</text><rect fill="#FEFECE" filter="url(#f1x6ai7c2bmgyi)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="37" x="1257.5" y="541.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="23" x="1264.5" y="561.2842">File</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="39" x2="81" y1="132.5625" y2="132.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="81" x2="81" y1="132.5625" y2="145.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="40" x2="81" y1="145.5625" y2="145.5625"/><polygon fill="#A80036" points="50,141.5625,40,145.5625,50,149.5625,46,145.5625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="46" y="119.9302">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="59" y="112.3638">generate the RSA</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="63" y="127.4966">server key pair</text><polygon fill="#A80036" points="303,170.5625,313,174.5625,303,178.5625,307,174.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="39" x2="309" y1="174.5625" y2="174.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="46" y="169.6294">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="59" y="169.6294">compromise the target host machine</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="357" y1="218.9609" y2="218.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="357" y1="218.9609" y2="231.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="316" x2="357" y1="231.9609" y2="231.9609"/><polygon fill="#A80036" points="326,227.9609,316,231.9609,326,235.9609,322,231.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="322" y="206.3286">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="335" y="198.7622">generate an infection specific</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="339" y="213.895">client RSA key pair</text><polygon fill="#A80036" points="647.5,271.9609,657.5,275.9609,647.5,279.9609,651.5,275.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="653.5" y1="275.9609" y2="275.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="322" y="263.5942">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="335" y="256.0278">encrypt the CPrivateRSA.pem with the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="339" y="271.1606">embedded SPublic.pem in the ransomware</text><polygon fill="#A80036" points="326,301.2266,316,305.2266,326,309.2266,322,305.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="320" x2="658.5" y1="305.2266" y2="305.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="332" y="300.2935">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="345" y="300.2935">save CPrivateRSA.bin on host machine</text><rect fill="none" height="104.5313" style="stroke: #000000; stroke-width: 2.0;" width="1027" x="281.5" y="320.3594"/><polygon fill="#EEEEEE" points="281.5,320.3594,358.5,320.3594,358.5,327.3594,348.5,337.3594,281.5,337.3594,281.5,320.3594" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="296.5" y="333.4263">loop</text><polygon fill="#A80036" points="1028,354.4922,1038,358.4922,1028,362.4922,1032,358.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="1034" y1="358.4922" y2="358.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="322" y="353.5591">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="335" y="353.5591">generate for each file a new 128 Bit AESKey</text><polygon fill="#A80036" points="1266,383.625,1276,387.625,1266,391.625,1270,387.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1040" x2="1272" y1="387.625" y2="387.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1047" y="382.6919">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="1060" y="382.6919">encrypt file with 128 Bit AESKey</text><polygon fill="#A80036" points="1051,412.7578,1041,416.7578,1051,420.7578,1047,416.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1045" x2="1277" y1="416.7578" y2="416.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1057" y="411.8247">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="1070" y="411.8247">save encrypted File.butterfly</text><polygon fill="#A80036" points="801,448.8906,791,452.8906,801,456.8906,797,452.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="795" x2="1039" y1="452.8906" y2="452.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="807" y="447.9575">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="820" y="447.9575">encrypt AESKey with CPublic.pem</text><polygon fill="#A80036" points="326,478.0234,316,482.0234,326,486.0234,322,482.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="320" x2="789" y1="482.0234" y2="482.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="332" y="477.0903">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="354" y="477.0903">save AESKey.bin</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="315" x2="357" y1="511.2891" y2="511.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="357" x2="357" y1="511.2891" y2="524.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="316" x2="357" y1="524.2891" y2="524.2891"/><polygon fill="#A80036" points="326,520.2891,316,524.2891,326,528.2891,322,524.2891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="322" y="506.2231">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="344" y="506.2231">display ransom note</text><!--
@startuml
'https://plantuml.com/sequence-diagram
actor attacker
participant SPrivateRSA.pem as SPrivate
actor target
participant "SPublic.pem\n(embedded)" as SPublic
participant CPrivateRSA.pem as CPrivate
participant CPublic.pem as CPublic
participant AESKey
participant File
autonumber

attacker -> attacker: generate the RSA\n server key pair
attacker -> target: compromise the target host machine

target -> target: generate an infection specific\n client RSA key pair
target -> CPrivate: encrypt the CPrivateRSA.pem with the\n embedded SPublic.pem in the ransomware
CPrivate -> target: save CPrivateRSA.bin on host machine
loop
target -> AESKey: generate for each file a new 128 Bit AESKey
AESKey -> File: encrypt file with 128 Bit AESKey
File -> AESKey: save encrypted File.butterfly
end
AESKey -> CPublic: encrypt AESKey with CPublic.pem
CPublic -> target: save AESKey.bin
target -> target: display ransom note
@enduml

PlantUML version 1.2017.15(Mon Jul 03 18:45:34 CEST 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.10+9-Ubuntu-0ubuntu1.18.04
Operating System: Linux
OS Version: 5.4.0-67-generic
Default Encoding: UTF-8
Language: de
Country: DE
--></g></svg>